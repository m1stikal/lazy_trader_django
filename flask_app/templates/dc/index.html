{% extends "dc/base.html" %}
{% block body_block %}

<script>
  var onLoaded = function() {
      var location_input = document.getElementById('{{feas_form.google_address.id_for_label}}');
      var autocomplete = new google.maps.places.Autocomplete(location_input);
      autocomplete.setComponentRestrictions({'country': 'ZA'});

  }
</script>

<div class="container">
  <div class="jumbotron">
    <h1>Feasibility Check</h1>
  </div>
  <!-- Input Form -->
  <div class="card" style="width:99%; margin: 0 auto;">
    <p>{{form_errors}}</p>
    <div class="card-body">
        <form method="POST">
          {% csrf_token %}
            <div class="mb-3">
              <div class="container">
                  <div class="row align-items-start">
                      <div class="col">
                          <label for={{feas_form.latitude.id_for_label}} class="form-label">{{feas_form.latitude.label}}</label>
                          <input type="text" class="form-control" id={{feas_form.latitude.id_for_label}} name={{feas_form.latitude.name}} value="{{latitude}}">
                      </div>
                      <div class="col">
                          <label for={{feas_form.longitude.id_for_label}} class="form-label">{{feas_form.longitude.label}}</label>
                          <input type="text" class="form-control" id={{feas_form.longitude.id_for_label}} name={{feas_form.longitude.name}} value="{{longitude}}">
                      </div>
                  </div>
              </div>
            </div>
            <div class="mb-6">
              <div class="container">
                  <div class="row align-items-start">
                      <div class="col">
                          <label for={{feas_form.google_address.id_for_label}} class="form-label">{{feas_form.google_address.label}}</label>
                          <input type="text" class="form-control" id={{feas_form.google_address.id_for_label}} name={{feas_form.google_address.name}} value="{{ google_address }}">
                      </div>
                  </div>
              </div>
            </div>
            <div class="mb-3">
                <div class="container">
                    <div class="row align-items-start">
                        <div class="col">
                            <label for={{feas_form.bandwidth.id_for_label}} class="form-label">{{feas_form.bandwidth.label}}</label>
                            <input type="text" class="form-control" id={{feas_form.bandwidth.id_for_label}} name={{feas_form.bandwidth.name}} value="{{feas_form.bandwidth.value}}">
                        </div>
                        <div class="col">
                            <label for={{feas_form.buildingheight.id_for_label}} class="form-label">{{feas_form.buildingheight.label}}</label>
                            <input type="number" class="form-control" id={{feas_form.buildingheight.id_for_label}} name={{feas_form.buildingheight.name}} value="{{feas_form.buildingheight.value}}">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mb-3">
              <div class="container">
                  <div class="row align-items-start">
                    <div class="col">
                      <h5>Feasibility Type:</h5>
                      {% for radio in feas_form.feas_type %}
                        <div class="form-check">
                          {{radio}}
                        </div>
                      {% endfor %}
        
                    </div>
                    
                      <div class="col">
                        <h5>Product:</h5>
                        {% for radio in feas_form.sla_type %}
                          <div class="form-check">
                            {{radio}}
                          </div>
                        {% endfor %}
                      </div>

                  </div>
              </div>
          

            
          </div>
            <div class="mb-3">
                <div class="container" style="text-align: center;">
                    <button type="submit" class="btn btn-primary mb-3">Check Feasibility</button>
                    <button type="reset" class="btn btn-primary mb-3">Reset</button>
                </div>
            </div>
        </form>
    </div>
  </div>

  
  
  <!-- Response Table -->
  
      
      
      {% if ptp %}
        
            <div class="jumbotron">
            <h5 class="card-title">PtP Results</h5>
            <table class="table table-striped">
              <thead>
                <tr>
                  <th scope="col">Site Code</th>
                  <th scope="col">Distance</th>
                  <th scope="col">Radio</th>
                  <th scope="col">TX Frequency</th>
                  <th scope="col">Channel Size</th>
                  <th scope="col">Modulation</th>
                  <th scope="col">Rain Fade RSSI</th>
                  <th scope="col">Clear Sky RSSI</th>
                  <th scope="col">RSSI Threshold</th>
                  <th scope="col">Requested Bandwidth</th>
                  <th scope="col">Link Throughput</th>
                  <th scope="col">Product</th>
                  <th scope="col">Link Uptime %</th>
                </tr>
              </thead>
              
              <tbody>
                {% for r in ptp %}
                  <tr>
                     
                      <td>{{ r.distance }}</td>
                      <td>{{ r.radio_code }}</td>
                      <td>{{ r.transmit_frequency }}</td>
                      <td>{{ r.channel_size }}</td>
                      <td>{{ r.modulation }}</td>
                      <td>{{ r.rain_fade_rssi }}</td>
                      <td>{{ r.clear_sky_rssi }}</td>
                      <td>{{ r.receive_threshold }}</td>
                      <td>{{ r.link_bandwidth }}</td>
                      <td>{{ r.throughput }}</td>
                      <td>{{ r.service_result }}</td>
                      <td>{{ r.uptime }}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        
      {% endif %}


      {% if offnet %}
        
            <div class="jumbotron">
          
            <h5 class="card-title">Offnet Results</h5>
            <table class="table table-striped">
              <thead>
                <tr>
                  <th scope="col">Site Code</th>
                  <th scope="col">Distance</th>
                  <th scope="col">Radio</th>
                  <th scope="col">TX Frequency</th>
                  <th scope="col">Channel Size</th>
                  <th scope="col">Modulation</th>
                  <th scope="col">Rain Fade RSSI</th>
                  <th scope="col">Clear Sky RSSI</th>
                  <th scope="col">RSSI Threshold</th>
                  <th scope="col">Requested Bandwidth</th>
                  <th scope="col">Link Throughput</th>
                </tr>
              </thead>
              
              <tbody>
                {% for r in offnet %}
                  <tr>
                      <td>{{ r.site_code }}</row></td>
                      <td>{{ r.link_distance }}</td>
                      <td>{{ r.radio_code }}</td>
                      <td>{{ r.transmit_frequency }}</td>
                      <td>{{ r.channel_size }}</td>
                      <td>{{ r.modulation }}</td>
                      <td>{{ r.rain_fade_rssi }}</td>
                      <td>{{ r.clear_sky_rssi }}</td>
                      <td>{{ r.receive_threshold }}</td>
                      <td>{{ r.link_bandwidth }}</td>
                      <td>{{ r.throughput }}</td>
                  </tr>
                {% endfor %}
              
              </tbody>
            </table>
          </div>
        
      {% endif %}

      {% if fiber %}
        
            <div class="jumbotron">
            <h5 class="card-title">Partner Network Results</h5>
            <table class="table table-striped">
              <thead>
                <tr>
                  <th class="col-md-4" scope="col">Solution</th>
                  <th class="col-md-4" scope="col">Comments</th>
                  <th class="col-md-4" scope="col">Medium</th>
                </tr>
              </thead>
          
              <tbody>
                {% for r in fiber %}
                  <tr>
                      <td class="col-md-4">{{ r.solution }}</row></td>
                      <td class="col-md-4">{{ r.message }}</td>
                      <td class="col-md-4">{{ r.medium }}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        
      {% endif %}

      

      {% if cx5.feasible %}
              
              <div class="jumbotron">
              <h5 class="card-title">CX-5 Results</h5>
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th scope="col">Site</th>
                    <th scope="col">Sector</th>
                    <th scope="col">Expected Receive Level</th>
                    <th scope="col">Tower Coordinates</th>
                    
                  </tr>
                </thead>
                
                <tbody>
                  
                    {% for r_key, r in cx5.servers.items %}
                    <tr>
                      <td>{{ r.site }}</td>
                      <td>{{ r.sector }}</td>
                      <td>{{ r.minimum_level }}</td>
                      <td>{{ r.coordinates }}</td>
                      
                    </tr>
                    {% endfor %}
                  
                  
                    
                  
                </tbody>
              </table>
            </div>
          
        {% endif %}
      
      {% if arc_results %}
        
            <div class="jumbotron">
            <h5 class="card-title">ARC Results</h5>
            <table class="table table-striped">
              <thead>
                <tr>
                  <th scope="col">Provider</th>
                  <th scope="col">Type</th>
                  <th scope="col">Name</th>
                </tr>
              </thead>
              
              <tbody>
                {% for r in arc_results %}
                <tr>
                  <td>{{ r.provider }}</row></td>
                  <td>{{ r.type }}</td>
                  <td>{{ r.name }}</td>
                </tr>
                {% endfor %}
              </tbody>
              
            </table>
          </div>
        
      {% endif %}
      
      <div class="jumbotron">
        <h5 >{{fcc_status}}</h5>
      </div>
        
  

  <div class="jumbotron">
    <p></p>
  </div>


  
{% if allSol %}

<script type="text/javascript">
  console.log(JSON.stringify('{{ rejected_sectors|escapejs }}'));
  console.log(JSON.stringify('{{ rejected_sites|escapejs }}'));
</script>


{% endif %}
<!-- LOS Charts -->
<div class="jumbotron">
<div class="card-group" style="width:99%; height:500px;margin: 0 auto;">

  {% for r in allSol %}
  


    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col">Product</th>
          <th scope="col">Equipment</th>
          <th scope="col">Base Station</th>

          {%if r.ptmp_solution%}
            <th scope="col">Sector Number</th>
          {%endif%}

          <th scope="col">Link Distance (m)</th>

          {%if r.ptmp_solution%}
          <th scope="col">Downlink RSSI</th>
          <th scope="col">Uplink RSSI</th>
          {%else%}
          <th scope="col">Rain Fade RSSI</th>
          <th scope="col">Clear Sky RSSI</th>
          {%endif%}
        </tr>
      </thead>
      <tbody>
          <tr>
              <td>{{ r.solution_type }}</row></td>
              <td>{{ r.cpe_type }}</td>
                
              {%if r.ptmp_solution%}
              <td>{{ r.sector }}</td>
              {%endif%}

              <td>{{ r.distance }}</td>
              
              {%if r.ptmp_solution%}
              <td>{{ r.worst_downlink_rssi }}</td>
              <td>{{ r.worst_uplink_rssi }}</td>
              {%else%}
              <td>{{ r.rain_fade_rssi }}</td>
              <td>{{ r.clear_sky_rssi }}</td>
              {%endif%}
          </tr>
      </tbody>
    </table>

  <div class="border" id={{r.container_id}}  style="width:99%; height:500px;margin: 0 auto;"></div>

  

  

  <script type="text/javascript">
    console.log(JSON.stringify('{{ r|escapejs }}'));
    
    Highcharts.chart({{r.container_id}}, {
        chart: {
            type: 'area'
        },
        title: {
            text: ''
        },
        subtitle: {
            text: 'Line of Sight (Client on Right, Base Station on Left)'
        },
        xAxis: {
            allowDecimals: false,
            labels: {
                formatter: function () {
                    return this.value; // clean, unformatted number for year
                }
            }
        },
        yAxis: {
            title: {
                text: 'Height'
            },
            labels: {
                formatter: function () {
                    return this.value;    //return this.value / 1000 + 'k';
                }
            }
        },
        yAxis: {
          min: {{r.y_axis_min|safe}}
        },
        //tooltip: {
        //    pointFormat: '{series.name} is {point.y:,.0f}<br/> Ground level is {point.x}'
        //},
        plotOptions: {
            area: {
                pointStart: 0,
                marker: {
                    enabled: false,
                    symbol: 'circle',
                    radius: 1,
                    states: {
                        hover: {
                            enabled: true
                        }
                    }
                }
            }
        },
        series: [{
            name: 'Upper 1st Fresnel Zone',
            type: 'line',
            color: '#4472c4',
            data: {{r.fres_1_upper|safe}},
            marker: {
                  enabled: false
              }
        }, {
            name: 'Lower 1st Fresnel Zone',
            type: 'line',
            color: '#4472c4',
            data: {{r.fres_1_lower|safe}},
            marker: {
                  enabled: false
              }
        }, {
            name: 'Upper 2nd Fresnel Zone',
            type: 'line',
            color: '#5b9bd5',
            data: {{r.fres_2_upper|safe}},
            marker: {
                  enabled: false
              }
        },{
            name: 'Lower 2nd Fresnel Zone',
            type: 'line',
            color: '#5b9bd5',
            data: {{r.fres_2_lower|safe}},
            marker: {
                  enabled: false
              }
        },  {
            name: 'Line of Sight',
            type: 'line',
            color: '#000000',
            data: {{r.los_profile|safe}},
            marker: {
                  enabled: false
              }
        },  {
            name: 'Terrain',
            type: 'area',
            color: '#70ad47',
            //clutter light grey color: '#a5a5a5'
            // clutter other grey colour: 44546a
            data: {{r.terrain|safe}}
        }
        ]
    });
    </script>

  {% endfor %}
</div>
</div>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDVE7FdnOL0ChcjR3uxCkJhEbGlMa_YXwQ&libraries=places&callback=onLoaded" async defer></script>

{% endblock %}
